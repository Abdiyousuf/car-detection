<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Car Detection Preview</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { height: 100vh; overflow: hidden; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 flex flex-col p-6">

<header class="mb-6">
    <h1 class="text-2xl font-bold text-indigo-400">Car Detection Preview</h1>
    <p class="text-slate-400 text-sm">Upload an image to run YOLOv8 detection</p>
</header>

<main class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-6">

    <!-- INPUT -->
    <section class="bg-slate-800 rounded-xl p-6 flex flex-col">
        <h2 class="text-lg font-semibold mb-4">Input Image</h2>

        <label class="flex-1 border-2 border-dashed border-slate-600 rounded-lg flex items-center justify-center cursor-pointer hover:border-indigo-500 overflow-hidden">
            <span id="inputText" class="text-slate-400">Click to upload image</span>
            <img id="inputPreview" class="hidden max-h-full max-w-full object-contain">
            <input id="fileInput" type="file" accept="image/*" class="hidden">
        </label>

        <button id="runBtn" class="mt-4 bg-indigo-600 hover:bg-indigo-500 py-3 rounded-lg font-medium">
            Run Detection
        </button>
    </section>

    <!-- OUTPUT -->
    <section class="bg-slate-800 rounded-xl p-6 flex flex-col">
        <h2 class="text-lg font-semibold mb-4">Detection Result</h2>

        <div class="flex-1 bg-black rounded-lg flex items-center justify-center overflow-hidden">
            <span id="placeholder" class="text-slate-500">Waiting for detection...</span>
            <img id="preview" class="hidden max-h-full max-w-full object-contain">
        </div>

        <div class="grid grid-cols-2 gap-4 mt-4">
            <div class="bg-slate-900 p-3 rounded">
                <p class="text-xs text-slate-400">Confidence</p>
                <p id="confScore" class="text-emerald-400 font-mono">--%</p>
            </div>
            <div class="bg-slate-900 p-3 rounded">
                <p class="text-xs text-slate-400">Objects</p>
                <p id="objCount" class="text-indigo-400 font-mono">0</p>
            </div>
        </div>
    </section>

</main>

<script>
const fileInput = document.getElementById("fileInput");
const runBtn = document.getElementById("runBtn");

const inputPreview = document.getElementById("inputPreview");
const inputText = document.getElementById("inputText");

const preview = document.getElementById("preview");
const placeholder = document.getElementById("placeholder");

const confScore = document.getElementById("confScore");
const objCount = document.getElementById("objCount");

// ðŸ”¹ SHOW INPUT IMAGE IMMEDIATELY
fileInput.onchange = () => {
    const file = fileInput.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
        inputPreview.src = reader.result;
        inputPreview.classList.remove("hidden");
        inputText.classList.add("hidden");
    };
    reader.readAsDataURL(file);
};

// ðŸ”¹ RUN DETECTION
runBtn.onclick = async () => {
    if (!fileInput.files.length) {
        alert("Please upload an image first");
        return;
    }

    placeholder.innerText = "Processing...";
    placeholder.classList.remove("hidden");
    preview.classList.add("hidden");

    const formData = new FormData();
    formData.append("image", fileInput.files[0]);

    try {
        const response = await fetch("/detect", {
            method: "POST",
            body: formData
        });

        const data = await response.json();

        preview.src = "data:image/jpeg;base64," + data.image;
        preview.classList.remove("hidden");
        placeholder.classList.add("hidden");

        confScore.innerText = data.confidence + "%";
        objCount.innerText = data.count;

    } catch (err) {
        placeholder.innerText = "Detection failed";
        console.error(err);
    }
};
</script>

</body>
</html>
